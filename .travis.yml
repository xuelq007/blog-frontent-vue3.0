language: node_js
node_js:
- 8.11.1
sudo: required
cache:
  directories:
  - node_modules
before_install:
- openssl aes-256-cbc -K $encrypted_92c453e01dfa_key -iv $encrypted_92c453e01dfa_iv
  -in id_rsa.enc -out ~/.ssh/id_rsa -d
- chmod 600 ~/.ssh/id_rsa
- sudo apt-get install -y sshpass
- nvm install 8.11.1
- node -v

script:
 - echo $PATH
 - npm run build

after_success:
- export SSHPASS=$DEPLOY_PASS
- sshpass -e ssh -o stricthostkeychecking=no root@101.132.179.88 "cd /usr/blog/blog-frontent-vue3.0 && git pull && echo $PATH && npm install && npm run build && echo 'deploy done'"
addons:
  ssh_known_hosts: 101.132.179.88
branches:
  only:
  - master
